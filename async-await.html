<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>async-await</title>
  </head>
  <body>
    <script>
      //1.async
      //   function fetchUser() {
      //     //do network request in 10 secs...
      //     return new Promise((resolve, reject) => {
      //       return resolve("elile");
      //     });
      //   }

      async function fetchUser() {
        //do network request in 10 secs...
        return "ellie";
      }
      //ë°”ë¡œ promiseë¥¼ return

      const user = fetchUser();
      console.log(user);
      //ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ë™ê¸°ì ì¸ ì²˜ë¦¬
      //í•œ ì¤„ì´ ëë‚˜ì•¼ ë‹¤ìŒ ì¤„ ì²˜ë¦¬í•¨
      //ì´ëŸ° ì¼ë“¤ì€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬
      //thenì´ë¼ëŠ” ì½œë°±í•¨ìˆ˜ë§Œ ì¤€ë¹„í•´ë†“ìœ¼ë©´, ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê² ë‹¤

      //2. await
      //asyncê°€ ë¶™ì€ í•¨ìˆ˜ ë‚´ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
      function delay(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }
      async function getApple() {
        //ê¸°ë‹¤ë ¤ì¤„ê²Œ
        await delay(1000);
        // throw "error";
        return "ğŸ";
      }
      async function getBanana() {
        await delay(1000);
        return "ğŸ¤";
        //3ì´ˆ ì§€ë‚˜ì„œ ìŒì‹ ë¦¬í„´
        //delayê°€ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ bananaë¥¼ ë¦¬í„´í•¨
      }
      //   function pickFruits() {
      //     return getApple().then((apple) => {
      //       return getBanana().then((banana) => `${apple} + ${banana}`);
      //     });
      //   }
      //   pickFruits().then(console.log);

      //async + await ê°™ì´ ì´ìš©
      //   async function pickFruits() {
      //     try {
      //       const apple = await getApple();
      //       const banana = await getBanana();
      //       return `${apple} + ${banana}`;
      //     } catch (error) {
      //       console.error(error);
      //     }
      //   }
      //   pickFruits().then(console.log);

      //promiseë„ ì¤‘ì²©ì ìœ¼ë¡œ ì²´ì´ë‹ì„ í•˜ê²Œ ë˜ë©´,
      //ì½œë°± ì§€ì˜¥ê³¼ ê°™ì€ ë¬¸ì œì  ë°©ì§€

      //awaitì˜ ë³‘ë ¬ ì²˜ë¦¬?
      //promiseë¥¼ ë°”ë¡œ í˜¸ì¶œí•˜ë©´, ì¦‰ì‹œ ì‹¤í–‰í•¨
      async function pickFruits() {
        const applePromise = getApple();
        const bananaPromise = getBanana();
        const apple = await applePromise;
        const banana = await bananaPromise;
        return `${apple} + ${banana}`;
      }
      pickFruits().then(console.log);

      //3. useful Promise APIs
      function pickAllFruits() {
        //ëª¨ë“  promiseë“¤ì´ ë³‘ë ¬ì ìœ¼ë¡œ ë°›ì„ ë•Œê¹Œì§€,ëª¨ì•„ì£¼ëŠ” api!
        //ë°°ì—´ í˜•íƒœ
        return Promise.all([getApple(), getBanana()]).then((fruits) =>
          fruits.join(" + ")
        );
      }
      pickAllFruits().then(console.log);

      //ê°€ì¥ ë¨¼ì € ê°’ì„ ë¦¬í„´í•˜ëŠ” ì•„ì´ ì¶œë ¥
      function pickOnlyOne() {
        return Promise.race([getApple(), getBanana()]);
      }
      pickOnlyOne().then(console.log);

      //callback-to-promise íŒŒì¼
      //async - awaitë¡œ ë°”ê¿”ë³´ê¸°

      // function taskA(a, b, cb) {
      //   setTimeout(() => {
      //     const res = a + b;
      //     cb(res);

      //   }, 3000);
      // }

      //   taskA(5, 5, (res) => {
      //     //resë¥¼ ì „ë‹¬í•´ì¤Œ
      //     console.log(`A TASK RESULT : `, res);
      //   });
      //   function taskB(a, cb) {
      //     setTimeout(() => {
      //       const res = a * 2;
      //       cb(res);
      //     }, 1000);
      //   }

      //   function taskC(a, cb) {
      //     setTimeout(() => {
      //       const res = a * -1;
      //       cb(res);
      //     }, 2000);
      //   }

      // taskA(4, 5, (a_res) => {
      //   console.log("A RESULT : ", a_res);
      //   //a_resì˜ ê²°ê³¼ê°’ì„ ê°€ì ¸ì˜´
      //   taskB(a_res, (b_res) => {
      //     console.log("B RESULT : ", b_res);
      //     taskC(b_res, (c_res) => {
      //       console.log("C RESULT : ", c_res);
      //     });
      //   });
      // });

      //ì½œë°± ì§€ì˜¥ì„ Promiseë¥¼ ì‚¬ìš©í•´ì„œ í•´ê²°í•˜ê¸°
      //aì—ì„œ ë°›ì•„ì˜¨ ê°’ -> bë¡œ ì „ë‹¬ -> bì—ì„œ ë°›ì•„ì˜¨ ê°’ -> cë¡œ ì „ë‹¬
      //ì œì¼ ë¨¼ì € í˜¸ì¶œí•  ê²ƒì€ taskA

      function taskA(a, b) {
        return new Promise((resolve, reject) =>
          setTimeout(() => {
            const res = a + b;
            resolve(res);
          }, 3000)
        );
      }

      function taskB(a) {
        return new Promise((resolve, reject) =>
          setTimeout(() => {
            const res = a * 2;
            resolve(res);
          }, 1000)
        );
      }
      function taskC(a) {
        return new Promise((resolve, reject) =>
          setTimeout(() => {
            const res = a * -1;
            resolve(res);
          }, 2000)
        );
      }
      taskA(4, 5)
        .then((res_a) => taskB(res_a))
        .then((res_b) => taskC(res_b))
        .then((res_c) => console.log(res_c));

      // taskA(4, 5)
      //   .then((a_res) => taskB(a_res))
      //   .then((b_res) => taskC(b_res))
      //   .then((res) => console.log(res));

      // taskA(4, 5)
      //   .then((a_res) => {
      //     console.log(a_res);
      //     return taskB(a_res);
      //     //ë°˜í™˜í•¨
      //   })
      //   .then((b_res) => {
      //     console.log(b_res);
      //     return taskC(b_res);
      //   })
      //   .then((c_res) => console.log(c_res));

      // //ì½œë°± í—¬ ë°œìƒ -> ê°„ë‹¨íˆ ì¤„ì´ëŠ” ë°©ë²•
      // taskA(4, 5).then((a_res) => {
      //   console.log(a_res);
      //   taskB(a_res).then((b_res) => {
      //     console.log(b_res);
      //     taskC(b_res).then((c_res) => {
      //       console.log(c_res);
      //     });
      //   });
      // });

      //thenì„ ë§ì´ ì‚¬ìš©í• ìˆ˜ë¡, ë°˜í™˜ ì†ë„ ëŠë ¤ì§??

      //ëŒ€ì¶© ì´ë ‡ê²Œ ë‚˜ì˜¤ê¸°ëŠ” í•˜ëŠ”ë°.........
      // (9 x 2) x -1 = -18
      //ì¢€ ë” ê°„ë‹¨í•˜ê²Œ ì¤„ì¼ ìˆ˜ëŠ” ì—†ì„ê¹Œ?

      // taskA(4, 5, (a_res) => {
      //   console.log("A RESULT : ", a_res);
      //   taskB(a_res, (b_res) => {
      //     console.log("B RESULT : ", b_res);
      //     taskC(b_res, (c_res) => {
      //       console.log("C RESULT : ", c_res);
      //     });
      //   });
      // });

      //Promise - ì½œë°±ì§€ì˜¥ì—ì„œ íƒˆì¶œí•˜ê¸°
      //Promiseë¥¼ ì‚¬ìš©í•¨
      //ì´ê±° êµ³ì´ ì½œë°±ì„ ë„£ì„ í•„ìš”ê°€ ìˆìŒ?

      //2ì´ˆ ë’¤ì— ìš°ë¦¬ê°€ ë„£ì€ ê°’ì´ ì–‘ìˆ˜ì¸ì§€ ìŒìˆ˜ì¸ì§€ íŒë‹¨í•˜ëŠ” í”„ë¡œê·¸ë¨ ë§Œë“¤ê¸°
      //ë„£ì€ ê°’- ì¸ìê°€ í•„ìš”í•¨
      //ë¹„ë™ê¸° ì‘ì—…

      //number íƒ€ì…ì´ë©´,

      function isPositive(number, resolve, reject) {
        setTimeout(() => {
          if (typeof number === "number") {
            //ì„±ê³µ -> resolve
            resolve(number >= 0 ? "ì–‘ìˆ˜" : "ìŒìˆ˜");
          } else {
            //ì‹¤íŒ¨ -> reject
            reject("ì£¼ì–´ì§„ ê°’ì´ ìˆ«ìí˜• ê°’ì´ ì•„ë‹™ë‹ˆë‹¤");
          }
        }, 2000);
      }

      // isPositive(
      //   [],
      //   (res) => {
      //     console.log("ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë¨ : ", res);
      //   },
      //   (err) => {
      //     console.log("ì‹¤íŒ¨í•˜ì˜€ìŒ  : ", err);
      //   }
      // );
      //promiseë¥¼ ì´ìš©í•´ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ë‹¤ì‹œ í•¨

      //number íŒŒë¼ë¯¸í„°ë¥¼ ì¡ìŒ
      // function isPositiveP(number) {
      //   return new Promise((resolve, reject) => {
      //     setTimeout(() => {
      //       if (typeof number === "number") {
      //         resolve(number >= 0 ? "ì–‘ìˆ˜" : "ìŒìˆ˜");
      //       } else {
      //         reject("ì£¼ì–´ì§„ ê°’ì´ ìˆ«ìí˜• ê°’ì´ ì•„ë‹™ë‹ˆë‹¤");
      //       }
      //     }, 3000);
      //   });
      // }

      // isPositiveP([])
      //   .then((res) => console.log(res))
      //   .catch((error) => {
      //     console.log(error);
      //   });

      function isPositiveP(number) {
        //executor í•¨ìˆ˜?
        //ì‹¤í–‰ìë¼ëŠ” ëœ»
        //ë¹„ë™ê¸° ì‘ì—…ì„ ì‹¤ì§ˆì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜
        const executor = (resolve, reject) => {
          setTimeout(() => {
            if (typeof number === "number") {
              //ì„±ê³µ -> resolve
              console.log(number);
              resolve(number >= 0 ? "ì–‘ìˆ˜" : "ìŒìˆ˜");
            } else {
              //ì‹¤íŒ¨ -> reject
              reject("ì£¼ì–´ì§„ ê°’ì´ ìˆ«ìí˜• ê°’ì´ ì•„ë‹™ë‹ˆë‹¤");
            }
          }, 2000);
        };
        //executor í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” ë²•
        //Promiseë¥¼ ì €ì¥í•  ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ë„˜ê²¨ì¤Œ
        const asyncTask = new Promise(executor);
        return asyncTask;
      }

      const res = isPositiveP([]);
      res
        .then((res) => {
          console.log("ì‘ì—… ì„±ê³µ : ", res);
        })
        .catch((error) => {
          console.log("ì‘ì—… ì‹¤íŒ¨ : ", error);
        });

      //resolve -> then í•¨ìˆ˜ë¡œ ë°›ì•„ì˜´
      //reject -> catch í•¨ìˆ˜ë¡œ ë°›ì•„ì˜´

      //ì–‘ìˆ˜/ìŒìˆ˜ë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•´ì„œëŠ”
      //ì½œë°±í•¨ìˆ˜ê°€ í•„ìš”í•¨ -> return
      //promsie ë°˜í™˜ê°’ -> ë¹„ë™ê¸°ì‘ì—…
      //ë¹„ë™ê¸° ì²˜ë¦¬ì˜ ê²°ê³¼ë¥¼ ì‚¬ìš©í•˜ëŠ” ë²• -> then

      //async & await - ì§ê´€ì ì¸ ë¹„ë™ê¸°ì²˜ë¦¬ ì½”ë“œ ì‘ì„±í•˜ê¸°
      function dealy(ms) {
        //promiseë¥¼ ë°˜í™˜í•¨
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve();
          }, ms);
        });
      }

      // async function helloAsync() {
      //   //ë¹„ë™ê¸°ë¡œ ë™ì‘í•  ê²ƒ ê°™ì€ í•¨ìˆ˜
      //   return dealy(3000).then(() => {
      //     return "hello Async";
      //   });
      // }
      // //return ê°’ì´ promiseì´ë¯€ë¡œ, thenì„ ì´ìš©í•´ì„œ ê°’ì„ ë¶ˆëŸ¬ì™€ì•¼ í•¨
      // helloAsync().then((res) => {
      //   console.log(res);
      // });

      //awaitì„ ì´ìš©í•´ì„œ ë°”ê¿”ë³´ê¸°
      //delay ì‹œê°„ê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ ë°˜í™˜í•¨
      //delayê°€ promise
      // async function helloAsync() {
      //   const result = await dealy(2000).then(() => {
      //     return "hello Async";
      //   });
      //   console.log(result);
      // }
      // helloAsync();

      async function helloAsync() {
        await dealy(2000); //2ì´ˆ ê¸°ë‹¤ë ¸ë‹¤ê°€,
        return "hello Async"; //ì¶œë ¥í•¨
      }
      // helloAsync().then((res) => {
      //   console.log(res);
      // });

      async function main() {
        //helloAsync ->
        const res = await helloAsync();
        console.log(res);
      }
      main();

      // console.log(hello()); //hello
      // console.log(helloAsync()); // //PromiseÂ {<fulfilled>: 'hello Async'}
      // //async í‚¤ì›Œë“œë¥¼ ë¶™ì´ë©´ Promiseë¥¼ ë°˜í™˜í•¨!
      // // -> thenì„ ì‚¬ìš© ê°€ëŠ¥í•¨
      // helloAsync().then(console.log); //hello Async
      // helloAsync().then((res) => {
      //   console.log(res);
      // });

      //async í‚¤ì›Œë“œë¥¼ ì•ì— ë¶™ì—¬ì¤€ í•¨ìˆ˜ì˜ ë¦¬í„´ê°’ì€
      //promiseì˜ resolveì˜ ê²°ê³¼ê°’ì´ ë¨
      //resolveë¡œ ìˆ˜í–‰í•œ ê²°ê³¼ë‘ ë˜‘ê°™ìŒ!
    </script>
  </body>
</html>

<!-- 

promise
-thenì„ ì´ìš©í•´ì„œ ì²´ì´ë‹ì´ ê°€ëŠ¥í•˜ì§€ë§Œ,
ê³„ì† ì‚¬ìš©í•˜ë‹¤ ë³´ë©´ ì½”ë“œê°€ ë³µì¡í•´ì§

í•´ê²°ë²•
-> async - await
ê¸°ì¡´ì˜ ì¡´ì¬í•˜ëŠ” promise ìœ„ì— ê°„í¸í•œ api ì œê³µ
=> syntactic sugar
í´ë˜ìŠ¤ - í”„ë¡œí† íƒ€ì… + ê°„í¸í•œ ë¬´ì–¸ê°€ê°€ ë§ë¶™ì—¬ì§

í•„ìš”ì— ë”°ë¼ ì‚¬ìš©í•¨
-í”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ ê°ì„ ì°¾ëŠ” ê²Œ ì¢‹ìŒ

-resolveì™€ rejectë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³ 
ë¦¬í„´ì„ í•˜ê²Œ ë˜ë©´, pendingì´ ëœ¸!
-rejectë‚˜ resolveë¥¼ ì´ìš©í•´ì•¼í•¨


fulfilled
-promiseë¥¼ ë¦¬í„´í•˜ê¸° ë•Œë¬¸ì—
-thenì„ ì´ìš©í•´ promiseë¥¼ í˜¸ì¶œí•œë‹¤

async-awaitë¡œ ê°„í¸í•˜ê²Œ promise
ì‚¬ìš©

*async!!
-> ë°”ë¡œ promsieë¡œ ë§Œë“¤ì–´ì¤Œ

await
-!!! ì¤‘ê´„í˜¸ + return!
-errorê°€ ë°œìƒí•œë‹¤ë©´(ì—¬ê¸°ì„œëŠ” throwë¡œ ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚´)
try-catchë¡œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•´ì¤˜ì•¼í•œë‹¤
try {
    //ì—ëŸ¬ ì²˜ë¦¬ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” êµ¬ë¬¸
}
catch(error) {
    console.error(error);
}

*awaitì˜ ë³‘ë ¬?
ì‚¬ê³¼ - 1ì´ˆ
ë°”ë‚˜ë‚˜ - 1ì´ˆ
ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰í•˜ê²Œ ë˜ë©´, ë¹„íš¨ìœ¨ì ì„
ì„œë¡œ ì—°ê´€ë˜ì–´ ìˆì§€ ì•Šì•„ì„œ, ê¸°ë‹¤ë¦´ í•„ìš”ê°€ ì—†ìŒ
ê°œì„ ?



 -->
